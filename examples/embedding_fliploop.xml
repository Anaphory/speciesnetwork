<?xml version='1.0' encoding='UTF-8'?>
<beast namespace="beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood" version="2.0">
  <data id="gene1" name="alignment">
    <sequence id="gene1_a1" taxon="a1" totalcount="4" value="-" />
    <sequence id="gene1_a2" taxon="a2" totalcount="4" value="-" />
  </data>

  <map name="Uniform">beast.math.distributions.Uniform</map>
  <map name="Exponential">beast.math.distributions.Exponential</map>
  <map name="LogNormal">beast.math.distributions.LogNormalDistributionModel</map>
  <map name="Normal">beast.math.distributions.Normal</map>
  <map name="Beta">beast.math.distributions.Beta</map>
  <map name="Gamma">beast.math.distributions.Gamma</map>
  <map name="LaplaceDistribution">beast.math.distributions.LaplaceDistribution</map>
  <map name="prior">beast.math.distributions.Prior</map>
  <map name="InverseGamma">beast.math.distributions.InverseGamma</map>
  <map name="OneOnX">beast.math.distributions.OneOnX</map>

  <init spec='beast.util.TreeParser' id='tree:species' IsLabelledNewick="true" adjustTipHeights="false" newick="((((A:0.1)#H1:0.1)#H2:0.3,#H4:0.1)#S2:0.1,((((#H1:0.1)#H3:0.1,#H2:0.1)#S1:0.1)#H4:0.1,#H3:0.3)#S3:0.1)#R"/>
  <init spec='beast.util.TreeParser' id='tree:gene1' IsLabelledNewick="true" adjustTipHeights="false" newick="(a1:1.0,a2:1.0)"/>

  <populationModel alpha="2.0" beta="1.0" id="popModel" spec="speciesnetwork.ConstantPopulationIO" />

  <run chainLength="100000" id="mcmc" spec="MCMC" storeEvery="100">
    <state id="state" storeEvery="100">
      <stateNode id="network:species" spec="speciesnetwork.NetworkParser" tree="@tree:species">
        <taxonset id="taxonSuperset" spec="TaxonSet">
          <taxon id="A" spec="TaxonSet">
            <taxon id="a1" spec="Taxon" />
            <taxon id="a2" spec="Taxon" />
          </taxon>
        </taxonset>
      </stateNode>
      <tree idref="tree:gene1" name="stateNode">
        <taxonset alignment="@gene1" id="TaxonSet:gene1" spec="TaxonSet" />
      </tree>
      <parameter id="gammaP" lower="0.0" upper="1.0" estimate="false" dimension="4" name="stateNode">0.5</parameter>
      <stateNode id="embedding:gene1" spec="parameter.IntegerParameter" dimension="24" minordimension="3">-1 -1 -1 -1 1 -1 0 -1 -1 0 -1 -1 0 0 -1 -1 -1 -1 -1 1 -1 0 1 -1</stateNode>
    </state>

    <!--
    <init estimate="false" id="initializer" method="random" spec="speciesnetwork.StarBeastInitializer" speciesNetwork="@network:species" geneTree="@tree:gene1" rebuildEmbedding="@rebuildEmbedding">
      <populationModel alpha="2.0" beta="1.0" id="popModel" spec="speciesnetwork.ConstantPopulationIO" />
    </init>
    -->

    <distribution id="posterior" spec="util.CompoundDistribution">
      <distribution id="speciescoalescent" populationModel="@popModel" spec="speciesnetwork.MultispeciesCoalescent" speciesNetwork="@network:species">
        <geneTree id="geneTree:gene1" ploidy="2.0" spec="speciesnetwork.GeneTreeInSpeciesNetwork" speciesNetwork="@network:species" geneTree="@tree:gene1" embedding="@embedding:gene1" gamma="@gammaP"/>
      </distribution>
      <distribution id="prior" spec="util.CompoundDistribution">
      </distribution>
      <distribution id="likelihood" spec="util.CompoundDistribution">
        <distribution data="@gene1" id="likelihood:gene1" spec="TreeLikelihood" tree="@tree:gene1">
          <siteModel gammaCategoryCount="4" id="siteModel:gene1" mutationRate="1.0" proportionInvariant="0.0" spec="SiteModel">
            <substModel id="jc:gene1" spec="JukesCantor"/>
          </siteModel>
          <branchRateModel clock.rate="1.0" id="clock:gene1" spec="beast.evolution.branchratemodel.StrictClockModel" />
        </distribution>
      </distribution>
    </distribution>

    <!--
    <operator id="rebuildEmbedding" spec="speciesnetwork.operators.RebuildEmbedding" geneTree="@tree:gene1" speciesNetwork="@network:species" taxonSuperset="@taxonSuperset" embedding="@embedding:gene1" weight="1.0"/>
    -->
    <operator id="flipNetworkLoop" spec="speciesnetwork.operators.FlipNetworkLoop" geneTree="@tree:gene1" speciesNetwork="@network:species" embedding="@embedding:gene1" weight="1.0"/>

    <operator id="scaleAndRebuild:gene1" spec="speciesnetwork.operators.JointReembedding" geneTree="@tree:gene1" speciesNetwork="@network:species" taxonSuperset="@taxonSuperset" embedding="@embedding:gene1" weight="5.0">
      <operator id="scale:gene1" scaleFactor="0.5" spec="ScaleOperator" tree="@tree:gene1" weight="5.0"/>
    </operator>

    <logger fileName="embedding.species.log" id="tracelog" logEvery="100" model="@posterior" sort="smart">
      <log idref="posterior" />
      <log idref="speciescoalescent" />
      <log idref="prior" />
      <log idref="likelihood" />
      <log idref="likelihood:gene1" />
    </logger>
    <logger fileName="embedding.gene1.log" id="tracelog:gene1" logEvery="100" model="@posterior" sort="smart">
      <log idref="embedding:gene1" />
    </logger>
    <logger id="screenlog" logEvery="100" model="@posterior">
      <log idref="posterior" />
      <log idref="speciescoalescent" />
      <log idref="prior" />
      <log idref="likelihood" />
    </logger>
    <logger fileName="embedding.species.trees" id="treelog:species" logEvery="100" mode="tree">
      <log id="networkLogger:species" spec="speciesnetwork.SpeciesNetworkLogger" speciesNetwork="@network:species" />
    </logger>
    <logger fileName="embedding.gene1.trees" id="treelog:gene1" logEvery="100" mode="tree">
      <log id="treeLogger:gene1" spec="beast.evolution.tree.TreeWithMetaDataLogger" tree="@tree:gene1" />
    </logger>
  </run>
</beast>
