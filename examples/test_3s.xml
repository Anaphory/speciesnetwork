<?xml version='1.0' encoding='UTF-8'?>
<beast namespace="beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood" version="2.0">
  <data id="gene1" name="alignment">
    <sequence id="gene1_a1" taxon="a1" totalcount="4" value="-"/>
    <sequence id="gene1_a2" taxon="a2" totalcount="4" value="-"/>
    <sequence id="gene1_b1" taxon="b1" totalcount="4" value="-"/>
    <sequence id="gene1_b2" taxon="b2" totalcount="4" value="-"/>
    <sequence id="gene1_c1" taxon="c1" totalcount="4" value="-"/>
    <sequence id="gene1_c2" taxon="c2" totalcount="4" value="-"/>
  </data>

  <map name="Uniform">beast.math.distributions.Uniform</map>
  <map name="Exponential">beast.math.distributions.Exponential</map>
  <map name="LogNormal">beast.math.distributions.LogNormalDistributionModel</map>
  <map name="Normal">beast.math.distributions.Normal</map>
  <map name="Beta">beast.math.distributions.Beta</map>
  <map name="Gamma">beast.math.distributions.Gamma</map>
  <map name="LaplaceDistribution">beast.math.distributions.LaplaceDistribution</map>
  <map name="InverseGamma">beast.math.distributions.InverseGamma</map>
  <map name="OneOnX">beast.math.distributions.OneOnX</map>
  <map name="prior">beast.math.distributions.Prior</map>

  <init spec='beast.util.TreeParser' id='newick:species' IsLabelledNewick="true" adjustTipHeights="false"
        newick="(((A:0.2,#H1[&amp;gamma=0.4]:0.1)d:0.3,((B:0.1)#H1:0.2,C:0.3)e:0.2)f:0.1)"/>
  <run chainLength="100000" id="mcmc" spec="MCMC">
    <state id="state" storeEvery="100">
      <stateNode id="network:species" spec="speciesnetwork.NetworkParser" tree="@newick:species">
        <taxonset id="taxonSuperset" spec="TaxonSet">
          <taxon id="A" spec="TaxonSet">
            <taxon id="a1" spec="Taxon"/>
            <taxon id="a2" spec="Taxon"/>
          </taxon>
          <taxon id="B" spec="TaxonSet">
            <taxon id="b1" spec="Taxon"/>
            <taxon id="b2" spec="Taxon"/>
          </taxon>
          <taxon id="C" spec="TaxonSet">
            <taxon id="c1" spec="Taxon"/>
            <taxon id="c2" spec="Taxon"/>
          </taxon>
        </taxonset>
      </stateNode>
      <tree id="tree:gene1" name="stateNode">
        <taxonset alignment="@gene1" id="taxonset:gene1" spec="TaxonSet"/>
      </tree>
      <stateNode id="embedding:gene1" spec="parameter.IntegerParameter">-1</stateNode>
    </state>

    <init estimate="false" id="initializer" method="random" spec="speciesnetwork.SpeciesNetworkInitializer" speciesNetwork="@network:species">
      <geneTree idref="tree:gene1"/>
      <rebuildEmbedding id="reEmbed:gene1" spec="speciesnetwork.operators.RebuildEmbedding" taxonSuperset="@taxonSuperset" speciesNetwork="@network:species" geneTree="@tree:gene1" embedding="@embedding:gene1" weight="0.0"/>
    </init>

    <distribution id="posterior" spec="util.CompoundDistribution">
      <distribution id="coalescent" spec="speciesnetwork.MultispeciesCoalescent" speciesNetwork="@network:species">
        <populationModel alpha="2.0" beta="1.0" id="popModel" spec="speciesnetwork.ConstantPopIntegrated"/>
        <geneTreeWithin id="geneTree:gene1" ploidy="2.0" spec="speciesnetwork.GeneTreeInSpeciesNetwork" speciesNetwork="@network:species" geneTree="@tree:gene1" embedding="@embedding:gene1"/>
      </distribution>
      <distribution id="prior" spec="util.CompoundDistribution">
      </distribution>
      <distribution id="likelihood" spec="util.CompoundDistribution">
        <distribution data="@gene1" id="likelihood:gene1" spec="TreeLikelihood" tree="@tree:gene1">
          <siteModel gammaCategoryCount="4" id="siteModel:gene1" mutationRate="1.0" proportionInvariant="0.0" spec="SiteModel">
            <substModel id="jc:gene1" spec="JukesCantor"/>
          </siteModel>
          <branchRateModel clock.rate="1.0" id="clock:gene1" spec="beast.evolution.branchratemodel.StrictClockModel"/>
        </distribution>
      </distribution>
    </distribution>

    <!-- operator id="rebuildEmbedding:gene1" spec="speciesnetwork.operators.RebuildEmbedding" taxonSuperset="@taxonSuperset" speciesNetwork="@network:species" geneTree="@tree:gene1" embedding="@embedding:gene1" weight="10.0"/ -->
    <operator id="scaleAndRebuild:gene1" spec="speciesnetwork.operators.JointReembedding" rebuildEmbedding="@reEmbed:gene1" weight="10.0">
      <operator id="scale:gene1" scaleFactor="0.1" spec="ScaleOperator" tree="@tree:gene1" weight="0.0"/>
    </operator>

    <logger id="screenlog" logEvery="1000" model="@posterior">
      <log idref="posterior"/>
      <log idref="coalescent"/>
      <log idref="prior"/>
      <log idref="likelihood"/>
    </logger>
    <logger fileName="test.trace.log" id="tracelog" logEvery="100" model="@posterior" sort="smart">
      <log idref="posterior"/>
      <log idref="coalescent"/>
      <log idref="prior"/>
      <log idref="likelihood"/>
    </logger>
    <logger fileName="test.species.trees" id="treelog:species" logEvery="100" mode="tree">
      <log id="networkLogger:species" spec="speciesnetwork.NetworkWithMetaDataLogger" speciesNetwork="@network:species"/>
    </logger>
    <logger fileName="test.gene1.embed.log" id="embedlog:gene1" logEvery="100" sort="smart">
      <log idref="embedding:gene1"/>
    </logger>
    <logger fileName="test.gene1.trees" id="treelog:gene1" logEvery="100" mode="tree">
      <log id="treeLogger:gene1" spec="beast.evolution.tree.TreeWithMetaDataLogger" tree="@tree:gene1"/>
    </logger>
  </run>
</beast>
